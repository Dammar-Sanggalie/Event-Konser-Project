<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile - Event Konser</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            '50': '#f0f9ff',
                            '100': '#e0f2fe',
                            '200': '#bae6fd',
                            '300': '#7dd3fc',
                            '400': '#38bdf8',
                            '500': '#0ea5e9',
                            '600': '#0284c7',
                            '700': '#0369a1',
                            '800': '#075985',
                            '900': '#0c4a6e'
                        },
                        secondary: '#4b5563',
                        accent: '#ec4899'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <link rel="stylesheet" href="/css/main.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body class="bg-gray-50 font-sans antialiased" data-page="edit-profile">
    
    <header id="navbar-placeholder"></header>
    
    <main class="min-h-screen bg-gray-50 pb-16">
        <div class="container mx-auto max-w-4xl px-4 py-8">
            
            <!-- Header -->
            <div class="mb-8">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Edit Profile</h1>
                        <p class="text-gray-600 mt-1">Update your personal information and preferences</p>
                    </div>
                    <button onclick="window.history.back()" class="px-4 py-2 text-gray-600 hover:bg-gray-200 rounded-lg transition">
                        ← Back
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                
                <!-- Sidebar Navigation -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-4 sticky top-24">
                        <nav class="space-y-2">
                            <button onclick="switchTab('personal')" data-tab="personal" class="profile-tab w-full text-left px-4 py-3 rounded-lg font-medium transition active:bg-primary-50 active:text-primary-600">
                                Personal Info
                            </button>
                            <button onclick="switchTab('address')" data-tab="address" class="profile-tab w-full text-left px-4 py-3 rounded-lg font-medium transition hover:bg-gray-50">
                                Address Book
                            </button>
                            <button onclick="switchTab('password')" data-tab="password" class="profile-tab w-full text-left px-4 py-3 rounded-lg font-medium transition hover:bg-gray-50">
                                Security
                            </button>
                            <button onclick="switchTab('preferences')" data-tab="preferences" class="profile-tab w-full text-left px-4 py-3 rounded-lg font-medium transition hover:bg-gray-50">
                                Preferences
                            </button>
                            <button onclick="switchTab('danger')" data-tab="danger" class="profile-tab w-full text-left px-4 py-3 rounded-lg font-medium transition hover:bg-gray-50">
                                Danger Zone
                            </button>
                        </nav>
                    </div>
                </div>
                
                <!-- Content Area -->
                <div class="lg:col-span-3">
                    
                    <!-- Personal Info Tab -->
                    <div id="personal-tab" class="profile-tab-content bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">Personal Information</h2>
                        
                        <form id="personal-form" class="space-y-6">
                            <!-- Profile Photo -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">Profile Photo</label>
                                <div class="flex items-center gap-4">
                                    <img id="profile-photo" src="/assets/images/placeholder.jpg" alt="Profile" class="w-24 h-24 rounded-full object-cover border-4 border-gray-200">
                                    <div>
                                        <input type="file" id="photo-input" accept="image/*" class="hidden">
                                        <button type="button" onclick="document.getElementById('photo-input').click()" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition font-medium text-sm">
                                            Change Photo
                                        </button>
                                        <p class="text-xs text-gray-600 mt-2">JPG, PNG or GIF. Max 5MB.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Name Fields -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                    <input type="text" id="first-name" placeholder="John" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                    <input type="text" id="last-name" placeholder="Doe" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                                </div>
                            </div>
                            
                            <!-- Contact Fields -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                <input type="email" id="email" placeholder="john@example.com" required readonly class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed" title="Email cannot be changed">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                                    <input type="tel" id="phone" placeholder="+62 812 3456 7890" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Date of Birth</label>
                                    <input type="date" id="dob" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                                </div>
                            </div>
                            
                            <!-- ID Card -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ID Card Type</label>
                                    <select id="id-type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                                        <option value="KTP">KTP</option>
                                        <option value="PASSPORT">Passport</option>
                                        <option value="SIM">SIM</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ID Card Number</label>
                                    <input type="text" id="id-number" placeholder="1234567890123456" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                                </div>
                            </div>
                            
                            <!-- Gender -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">Gender</label>
                                <div class="flex gap-4">
                                    <label class="flex items-center">
                                        <input type="radio" name="gender" value="male" class="w-4 h-4" required>
                                        <span class="ml-2 text-gray-700">Male</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="gender" value="female" class="w-4 h-4">
                                        <span class="ml-2 text-gray-700">Female</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="gender" value="other" class="w-4 h-4">
                                        <span class="ml-2 text-gray-700">Other</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Save Button -->
                            <div class="flex gap-3 pt-4 border-t">
                                <button type="button" onclick="resetForm('personal')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium">
                                    Cancel
                                </button>
                                <button type="submit" class="px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition font-medium">
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Address Book Tab -->
                    <div id="address-tab" class="profile-tab-content hidden bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-gray-900">Address Book</h2>
                            <button onclick="addNewAddress()" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition font-medium text-sm">
                                + Add Address
                            </button>
                        </div>
                        
                        <div id="addresses-list" class="space-y-4">
                            <!-- Addresses populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Security Tab -->
                    <div id="password-tab" class="profile-tab-content hidden bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">Security Settings</h2>
                        
                        <form id="password-form" class="space-y-6 max-w-md">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Current Password</label>
                                <input type="password" id="current-password" placeholder="••••••••" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">New Password</label>
                                <input type="password" id="new-password" placeholder="••••••••" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                                <p class="text-xs text-gray-600 mt-2">At least 8 characters, with uppercase, lowercase, numbers and symbols</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                                <input type="password" id="confirm-password" placeholder="••••••••" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                            </div>
                            
                            <div class="flex gap-3 pt-4 border-t">
                                <button type="button" onclick="resetForm('password')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium">
                                    Cancel
                                </button>
                                <button type="submit" class="px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition font-medium">
                                    Change Password
                                </button>
                            </div>
                        </form>
                        
                        <!-- Two-Factor Authentication -->
                        <div class="mt-12 pt-8 border-t">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Two-Factor Authentication</h3>
                            <p class="text-gray-600 mb-4">Add an extra layer of security to your account</p>
                            <button class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium">
                                Enable 2FA
                            </button>
                        </div>
                        
                        <!-- Active Sessions -->
                        <div class="mt-12 pt-8 border-t">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Active Sessions</h3>
                            <div id="sessions-list" class="space-y-3">
                                <!-- Sessions populated by JS -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Preferences Tab -->
                    <div id="preferences-tab" class="profile-tab-content hidden bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-6">Preferences</h2>
                        
                        <form id="preferences-form" class="space-y-6 max-w-md">
                            <!-- Email Notifications -->
                            <div class="space-y-3">
                                <h3 class="font-semibold text-gray-900">Email Notifications</h3>
                                
                                <label class="flex items-center">
                                    <input type="checkbox" id="notify-order" checked class="w-4 h-4 text-primary-600">
                                    <span class="ml-2 text-gray-700">Order updates & confirmations</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input type="checkbox" id="notify-promo" checked class="w-4 h-4 text-primary-600">
                                    <span class="ml-2 text-gray-700">Promotions & special offers</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input type="checkbox" id="notify-newsletter" checked class="w-4 h-4 text-primary-600">
                                    <span class="ml-2 text-gray-700">Weekly newsletter</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input type="checkbox" id="notify-reminder" checked class="w-4 h-4 text-primary-600">
                                    <span class="ml-2 text-gray-700">Event reminders</span>
                                </label>
                            </div>
                            
                            <!-- Language & Regional -->
                            <div class="pt-4 border-t space-y-3">
                                <h3 class="font-semibold text-gray-900">Language & Regional</h3>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                                    <select id="language" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                                        <option value="id">Indonesia (Bahasa)</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Currency</label>
                                    <select id="currency" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none">
                                        <option value="IDR">IDR (Rp)</option>
                                        <option value="USD">USD ($)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Save Button -->
                            <div class="flex gap-3 pt-4 border-t">
                                <button type="button" onclick="resetForm('preferences')" class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium">
                                    Cancel
                                </button>
                                <button type="submit" class="px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition font-medium">
                                    Save Preferences
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Danger Zone Tab -->
                    <div id="danger-tab" class="profile-tab-content hidden bg-white rounded-lg shadow-md p-6 border-2 border-red-200">
                        <h2 class="text-2xl font-bold text-red-900 mb-6"> Danger Zone</h2>
                        
                        <!-- Delete Account -->
                        <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                            <h3 class="font-semibold text-red-900 mb-2">Delete Account</h3>
                            <p class="text-sm text-red-800 mb-4">
                                Deleting your account is permanent and cannot be undone. All your data, orders, and preferences will be permanently removed.
                            </p>
                            <button onclick="showDeleteModal()" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium">
                                Delete My Account
                            </button>
                        </div>
                        
                        <!-- Export Data -->
                        <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-6">
                            <h3 class="font-semibold text-blue-900 mb-2">Export Your Data</h3>
                            <p class="text-sm text-blue-800 mb-4">
                                Download a copy of your personal data in CSV format.
                            </p>
                            <button class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                                Export Data
                            </button>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </main>
    
    <!-- Delete Account Modal -->
    <div id="delete-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-4">
            <h2 class="text-xl font-bold text-red-900 mb-2">Delete Account?</h2>
            <p class="text-gray-600 mb-4">
                This action is permanent. All your data will be permanently deleted. Type "DELETE" to confirm.
            </p>
            
            <input type="text" id="delete-confirm" placeholder="Type DELETE to confirm" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 outline-none mb-6">
            
            <div class="flex gap-3">
                <button onclick="closeDeleteModal()" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition font-medium">
                    Cancel
                </button>
                <button onclick="confirmDelete()" id="delete-confirm-btn" disabled class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                    Delete Account
                </button>
            </div>
        </div>
    </div>
    
    <footer id="footer-placeholder"></footer>
    
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/app.js"></script>
    
    <script>
        let userProfile = null;
        
        document.addEventListener('DOMContentLoaded', async () => {
            if (!window.auth.isAuthenticated()) {
                window.location.href = '/login.html?redirect=' + encodeURIComponent(window.location.pathname);
                return;
            }
            
            try {
                await loadUserProfile();
                setupEventListeners();
            } catch (e) {
                console.error('Error loading profile:', e);
                showToast('Failed to load profile', 'error');
            }
        });
        
        async function loadUserProfile() {
            const userId = window.auth.getUserId();
            const response = await fetch(`${window.API_BASE_URL}/users/${userId}`, {
                headers: { 'Authorization': 'Bearer ' + window.auth.getToken() }
            });
            
            if (!response.ok) throw new Error('Failed to fetch profile');
            
            userProfile = await response.json();
            populateProfileForms();
        }
        
        function populateProfileForms() {
            const user = userProfile.data || userProfile;
            
            // Personal Info
            document.getElementById('first-name').value = user.namaDepan || '';
            document.getElementById('last-name').value = user.namaBelakang || '';
            document.getElementById('email').value = user.email || '';
            document.getElementById('phone').value = user.noTelepon || '';
            document.getElementById('dob').value = user.tanggalLahir || '';
            document.getElementById('id-type').value = user.jenisIdentitas || 'KTP';
            document.getElementById('id-number').value = user.nomorIdentitas || '';
            
            if (user.foto) {
                document.getElementById('profile-photo').src = user.foto;
            }
            
            // Load addresses
            loadAddresses(user.alamat || []);
        }
        
        function loadAddresses(addresses) {
            const container = document.getElementById('addresses-list');
            if (addresses.length === 0) {
                container.innerHTML = '<p class="text-gray-600">No addresses saved yet</p>';
                return;
            }
            
            container.innerHTML = addresses.map((addr, idx) => `
                <div class="border border-gray-200 rounded-lg p-4 flex justify-between items-start">
                    <div>
                        <p class="font-semibold text-gray-900">${addr.label || 'Address ' + (idx + 1)}</p>
                        <p class="text-sm text-gray-600">${addr.jalan}</p>
                        <p class="text-sm text-gray-600">${addr.kota}, ${addr.provinsi} ${addr.kodePOS}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editAddress(${idx})" class="text-primary-600 hover:underline text-sm font-medium">Edit</button>
                        <button onclick="deleteAddress(${idx})" class="text-red-600 hover:underline text-sm font-medium">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        function setupEventListeners() {
            // Photo upload
            document.getElementById('photo-input').addEventListener('change', handlePhotoUpload);
            
            // Form submissions
            document.getElementById('personal-form').addEventListener('submit', savePersonalInfo);
            document.getElementById('password-form').addEventListener('submit', changePassword);
            document.getElementById('preferences-form').addEventListener('submit', savePreferences);
            
            // Delete confirmation
            document.getElementById('delete-confirm').addEventListener('input', (e) => {
                document.getElementById('delete-confirm-btn').disabled = e.target.value !== 'DELETE';
            });
            
            // Tab switching
            document.querySelectorAll('.profile-tab').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.profile-tab').forEach(b => {
                        b.classList.remove('bg-primary-50', 'text-primary-600');
                        b.classList.add('hover:bg-gray-50');
                    });
                    btn.classList.add('bg-primary-50', 'text-primary-600');
                    btn.classList.remove('hover:bg-gray-50');
                });
            });
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.profile-tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(tabName + '-tab').classList.remove('hidden');
        }
        
        async function handlePhotoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('foto', file);
            
            try {
                const response = await fetch(`${window.API_BASE_URL}/users/${window.auth.getUserId()}/photo`, {
                    method: 'POST',
                    headers: { 'Authorization': 'Bearer ' + window.auth.getToken() },
                    body: formData
                });
                
                if (response.ok) {
                    document.getElementById('profile-photo').src = URL.createObjectURL(file);
                    showToast('Photo uploaded successfully', 'success');
                }
            } catch (error) {
                console.error('Error uploading photo:', error);
                showToast('Failed to upload photo', 'error');
            }
        }
        
        async function savePersonalInfo(e) {
            e.preventDefault();
            
            const payload = {
                namaDepan: document.getElementById('first-name').value,
                namaBelakang: document.getElementById('last-name').value,
                noTelepon: document.getElementById('phone').value,
                tanggalLahir: document.getElementById('dob').value,
                jenisIdentitas: document.getElementById('id-type').value,
                nomorIdentitas: document.getElementById('id-number').value,
                jenisKelamin: document.querySelector('input[name="gender"]:checked').value
            };
            
            try {
                const response = await fetch(`${window.API_BASE_URL}/users/${window.auth.getUserId()}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + window.auth.getToken()
                    },
                    body: JSON.stringify(payload)
                });
                
                if (response.ok) {
                    showToast('Personal information updated successfully', 'success');
                } else {
                    showToast('Failed to update information', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('An error occurred', 'error');
            }
        }
        
        async function changePassword(e) {
            e.preventDefault();
            
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (newPassword !== confirmPassword) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${window.API_BASE_URL}/users/change-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + window.auth.getToken()
                    },
                    body: JSON.stringify({
                        currentPassword: document.getElementById('current-password').value,
                        newPassword: newPassword
                    })
                });
                
                if (response.ok) {
                    showToast('Password changed successfully', 'success');
                    document.getElementById('password-form').reset();
                } else {
                    showToast('Failed to change password', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('An error occurred', 'error');
            }
        }
        
        async function savePreferences(e) {
            e.preventDefault();
            
            const payload = {
                notifikasiOrder: document.getElementById('notify-order').checked,
                notifikasiPromo: document.getElementById('notify-promo').checked,
                notifikasiNewsletter: document.getElementById('notify-newsletter').checked,
                notifikasiReminder: document.getElementById('notify-reminder').checked,
                bahasa: document.getElementById('language').value,
                mata_uang: document.getElementById('currency').value
            };
            
            try {
                const response = await fetch(`${window.API_BASE_URL}/users/${window.auth.getUserId()}/preferences`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + window.auth.getToken()
                    },
                    body: JSON.stringify(payload)
                });
                
                if (response.ok) {
                    showToast('Preferences saved successfully', 'success');
                } else {
                    showToast('Failed to save preferences', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('An error occurred', 'error');
            }
        }
        
        function addNewAddress() {
            // This would open an address form modal in a full implementation
            showToast('Add address feature - coming soon', 'info');
        }
        
        function editAddress(idx) {
            showToast('Edit address feature - coming soon', 'info');
        }
        
        function deleteAddress(idx) {
            showToast('Delete address feature - coming soon', 'info');
        }
        
        function showDeleteModal() {
            document.getElementById('delete-modal').classList.remove('hidden');
        }
        
        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.add('hidden');
            document.getElementById('delete-confirm').value = '';
            document.getElementById('delete-confirm-btn').disabled = true;
        }
        
        async function confirmDelete() {
            try {
                const response = await fetch(`${window.API_BASE_URL}/users/${window.auth.getUserId()}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': 'Bearer ' + window.auth.getToken() }
                });
                
                if (response.ok) {
                    showToast('Account deleted successfully', 'success');
                    window.auth.logout();
                    setTimeout(() => window.location.href = '/', 2000);
                } else {
                    showToast('Failed to delete account', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('An error occurred', 'error');
            }
            closeDeleteModal();
        }
        
        function resetForm(tabName) {
            if (tabName === 'personal') {
                loadUserProfile();
            } else if (tabName === 'password') {
                document.getElementById('password-form').reset();
            } else if (tabName === 'preferences') {
                loadUserProfile();
            }
        }
        
        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-6 right-6 px-6 py-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            } text-white`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>
</html>
